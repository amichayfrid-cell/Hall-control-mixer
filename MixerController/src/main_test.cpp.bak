#include <Arduino.h>

// Waveshare ESP32-S3-Touch-LCD-4.3B RS485 Pins (From 02_RS485_Test.ino)
#define RS485_TX 44
#define RS485_RX 43

void setup() {
    Serial.begin(115200);
    Serial.println("--- Mixer Controller RS485 TEST ---");
    Serial.println("Transmitting on GPIO 15 (TX)...");

    // Initialize RS485
    // Note: Waveshare board usually handles direction automatically / via hardware.
    // If manual DE is needed, it might be IO 4 or something else, but standard docs say auto.
    Serial1.begin(115200, SERIAL_8N1, RS485_RX, RS485_TX);
}

void loop() {
    static int counter = 0;
    
    // Create a JSON packet similar to the real one
    // We toggle the relay state every time to confirm reception visually/audibly.
    int relayState = (counter % 2); 
    
    Serial.printf("[TX] Sending Packet %d (Relay: %d)...\n", counter, relayState);
    
    // Command format expected by Body: {"mv":80, "cv":50, "mr":1, "cr":0}
    Serial1.printf("{\"mv\":80,\"cv\":50,\"mr\":%d,\"cr\":0}\n", relayState);
    
    counter++;
    delay(2000); // Send every 2 seconds
}
